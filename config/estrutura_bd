CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    senha VARCHAR(255) NOT NULL,
    telefone VARCHAR(20),
    nivel ENUM('aluno', 'admin') DEFAULT 'aluno',
    data_expiracao DATE DEFAULT NULL,
    foto VARCHAR(255) DEFAULT 'assets/img/user-default.png',
    data_cadastro DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE pagamentos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT NOT NULL,
    descricao VARCHAR(100) NOT NULL, /* Ex: Mensal, Trimestral */
    valor DECIMAL(10, 2) NOT NULL,
    data_vencimento DATE NOT NULL,
    data_pagamento DATE, /* Se null, está pendente */
    status ENUM('pago', 'pendente', 'atrasado') DEFAULT 'pago',
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE CASCADE
);

-- (Opcional) Cria um Admin padrão para você testar
-- Senha do admin abaixo é: "admin123" (já criptografada)
INSERT INTO usuarios (nome, email, senha, nivel) 
VALUES ('Ryan Admin', 'admin@ryancoach.com', '$2y$10$7Kz.Xq.8/5V.5V.5V.5V.e/5V.5V.5V.5V.5V.5V.5V.5V.5V.5', 'admin');

CREATE TABLE treinos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    aluno_id INT NOT NULL,
    admin_id INT NOT NULL, 
    nome VARCHAR(100) NOT NULL, 
    nivel_plano ENUM('basico', 'avancado', 'premium') NOT NULL,
    data_inicio DATE NOT NULL,
    data_fim DATE NOT NULL,
    
    dias_semana VARCHAR(50) NOT NULL, 
    
    divisao_nome VARCHAR(50),
    observacoes TEXT,
    ativo BOOLEAN DEFAULT 1,
    criado_em DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (aluno_id) REFERENCES usuarios(id) ON DELETE CASCADE,
    FOREIGN KEY (admin_id) REFERENCES usuarios(id)
);

CREATE TABLE periodizacoes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    treino_id INT NOT NULL,
    data_inicio_macro DATE NOT NULL,
    data_fim_macro DATE NOT NULL,
    objetivo_macro VARCHAR(255), 
    FOREIGN KEY (treino_id) REFERENCES treinos(id) ON DELETE CASCADE
);

CREATE TABLE microciclos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    periodizacao_id INT NOT NULL,
    semana_numero INT NOT NULL, 
    nome_fase VARCHAR(100), 
    foco_comentario TEXT, 
    
    reps_compostos VARCHAR(50), 
    reps_isoladores VARCHAR(50), 
    descanso_compostos INT DEFAULT 90,
    descanso_isoladores INT DEFAULT 60,
    
    data_inicio_semana DATE, 
    data_fim_semana DATE,
    
    FOREIGN KEY (periodizacao_id) REFERENCES periodizacoes(id) ON DELETE CASCADE
);

CREATE TABLE treino_divisoes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    treino_id INT NOT NULL,
    letra VARCHAR(5) NOT NULL, 
    nome VARCHAR(100), 
    FOREIGN KEY (treino_id) REFERENCES treinos(id) ON DELETE CASCADE
);

CREATE TABLE exercicios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    divisao_id INT NOT NULL,
    nome_exercicio VARCHAR(200) NOT NULL,
    tipo_mecanica ENUM('composto', 'isolador', 'livre') DEFAULT 'livre', 
    video_url VARCHAR(255), 
    observacao_exercicio VARCHAR(255), 
    ordem INT NOT NULL, 
    FOREIGN KEY (divisao_id) REFERENCES treino_divisoes(id) ON DELETE CASCADE
);

CREATE TABLE series (
    id INT AUTO_INCREMENT PRIMARY KEY,
    exercicio_id INT NOT NULL,
    categoria ENUM('warmup', 'feeder', 'work', 'top', 'backoff', 'falha') NOT NULL,
    quantidade INT DEFAULT 1, 
    
    reps_fixas VARCHAR(50), 
    descanso_fixo VARCHAR(50),
    carga_prevista VARCHAR(50), 
    rpe_previsto INT, 
    
    FOREIGN KEY (exercicio_id) REFERENCES exercicios(id) ON DELETE CASCADE
);

CREATE TABLE treino_historico (
    id INT AUTO_INCREMENT PRIMARY KEY,
    aluno_id INT NOT NULL,
    treino_id INT NOT NULL,
    divisao_id INT NOT NULL,
    exercicio_id INT NOT NULL,
    serie_numero INT NOT NULL,
    reps_realizadas INT,
    carga_kg DECIMAL(5,2),
    data_treino DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (aluno_id) REFERENCES usuarios(id) ON DELETE CASCADE,
    FOREIGN KEY (exercicio_id) REFERENCES exercicios(id) ON DELETE CASCADE
);